/* Adjust single-window header: keep header visually lighter but preserve inline model picker button styling */
.single-chat-modern .chat-header-modern {
  /* make header visually minimal but keep a subtle separator to distinguish header from messages */
  background: none;
  /* restore a thin subtle border to separate header and content in single-window view */
  border-bottom: var(--border-thin);
  border-color: var(--polychat-accent-muted);
  box-shadow: none;
  padding-left: 0;
  padding-right: 0;
}

/* Multi Chat Window Moderne - Styles */

.multi-chat-container-modern {
  height: 100%;
  overflow: hidden;
  background: var(--polychat-bg-primary);
  display: flex;
  flex-direction: column;
}

.single-chat-modern {
  height: 100%;
  display: flex;
  flex-direction: column;
  min-height: 0;
  margin: var(--spacing-md);
}

.multi-chat-grid-modern {
  display: grid;
  gap: var(--spacing-md);
  height: 100%;
  padding: var(--spacing-md);
  overflow: hidden;
  min-height: 0;
}

.multi-chat-grid-modern.grid-2 {
  grid-template-columns: 1fr 1fr;
}

.multi-chat-grid-modern.grid-3 {
  grid-template-columns: 1fr 1fr 1fr;
}

/* Hauteur spécifique pour mode multi-chat */
.multi-chat-grid-modern .chat-session-modern {
  max-height: 70vh; /* Augmenté de 60vh à 70vh */
}

.multi-chat-grid-modern .chat-messages-modern {
  max-height: 50vh; /* Augmenté de 40vh à 50vh */
}

.chat-session-modern {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
  max-height: none;
  background: none !important;
}

.chat-window-modern {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--gradient-glass);
  -webkit-backdrop-filter: blur(20px);
  backdrop-filter: blur(20px);
  border: var(--border-thin);
  border-radius: 22px;
  box-shadow: var(--shadow-lg);
  overflow: hidden;
  transition: var(--transition-normal);
  min-height: 0;
}

.chat-window-modern:hover {
  box-shadow: var(--shadow-xl);
  border-color: var(--polychat-accent-primary);
}

/* Header du chat modernisé */
.chat-header-modern {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md) var(--spacing-lg) var(--spacing-md) var(--spacing-4xl);
  background: var(--gradient-dark);
  border-bottom: var(--border-thin);
  border-color: var(--polychat-accent-muted);
  flex-shrink: 0;
}

.chat-header-modern-info {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin-left: var(--spacing-md);
}

/* Prevent header details from overflowing: allow truncation and proper flex behavior */
.chat-header-modern-details {
  display: flex;
  flex-direction: column;
  min-width: 0; /* allow children to shrink */
  max-width: 40vw; /* limit width relative to viewport to avoid overflow */
}

.chat-header-modern-details > * {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.chat-header-modern-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: var(--polychat-accent-primary);
  color: var(--polychat-text-inverse);
  border-radius: 18px;
  box-shadow: var(--shadow-sm);
}

.chat-header-modern-details {
  display: flex;
  flex-direction: column;
}

.chat-header-modern-title {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: var(--polychat-text-primary);
  margin: 0;
  line-height: 1.2;
}

.chat-header-modern-subtitle {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 38vw; /* keep subtitle slightly narrower */
}

/* Select inline pour sessions pending */
.chat-model-inline-select {
  -webkit-appearance: none;
  appearance: none;
  background: linear-gradient(135deg, rgba(45,52,64,.6) 0%, rgba(40,47,59,.55) 100%);
  border: 1px solid rgba(139,92,246,.35);
  font-family: 'Space Grotesk', sans-serif;
  font-size: 13px;
  font-weight: 500;
  color: var(--polychat-text-primary);
  padding: 6px 26px 6px 10px;
  border-radius: 10px;
  cursor: pointer;
  position: relative;
  outline: none;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 2px 6px -2px rgba(0,0,0,.4);
  transition: all .3s cubic-bezier(.4,0,.2,1);
}
.chat-model-inline-select:hover {
  background: linear-gradient(135deg, rgba(90,60,170,.75) 0%, rgba(70,40,140,.7) 100%);
  border-color: rgba(139,92,246,.6);
  box-shadow: 0 4px 14px -4px rgba(139,92,246,.5), inset 0 1px 0 rgba(255,255,255,0.12);
  color: #fff;
}
.chat-model-inline-select:focus-visible {
  outline: 2px solid var(--polychat-accent-primary);
  outline-offset: 2px;
}
.chat-model-inline-select option {
  background: #1d2330;
  color: var(--polychat-text-primary);
  font-family: 'Space Grotesk', sans-serif;
  font-size: 13px;
  padding: 4px 8px;
}

/* InlineModelPicker (custom popover) */
.inline-model-picker { position: relative; display:inline-block; }
.imp-trigger { display:inline-flex; align-items:center; gap:6px; background:linear-gradient(135deg,rgba(45,52,64,.6) 0%,rgba(40,47,59,.55) 100%); border:1px solid rgba(139,92,246,.35); color:var(--polychat-text-primary); font-family:'Space Grotesk',sans-serif; font-size:12px; padding:6px 12px; border-radius:12px; cursor:pointer; transition:all .3s cubic-bezier(.4,0,.2,1); box-shadow:0 2px 6px -2px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.08); }
.imp-trigger:hover { background:linear-gradient(135deg,rgba(96,52,180,.75) 0%,rgba(74,36,150,.7) 100%); border-color:rgba(139,92,246,.65); color:#fff; box-shadow:0 4px 14px -4px rgba(139,92,246,.5), inset 0 1px 0 rgba(255,255,255,.15); }
.inline-model-picker.open .imp-trigger { background:linear-gradient(135deg,#8b5cf6 0%,#7c3aed 100%); color:#fff; border-color:#8b5cf6; box-shadow:0 0 0 1px rgba(139,92,246,.6),0 8px 22px -8px rgba(139,92,246,.55), inset 0 1px 0 rgba(255,255,255,.22); }
.imp-caret { transition:transform .35s cubic-bezier(.65,-0.4,.3,1.4); opacity:.75; }
.inline-model-picker.open .imp-caret { transform:rotate(180deg); opacity:1; }
.imp-pop { position:absolute; top:110%; left:0; z-index:60; min-width:280px; max-width:340px; background:rgba(18,22,30,.95); -webkit-backdrop-filter:blur(24px); backdrop-filter:blur(24px); border:1px solid rgba(139,92,246,.25); border-radius:16px; padding:14px 14px 10px; box-shadow:0 16px 32px -8px rgba(0,0,0,.5), 0 6px 14px -4px rgba(139,92,246,.2), inset 0 1px 0 rgba(255,255,255,.06); animation:modernFadeIn .4s ease; }
.imp-search { display:flex; align-items:center; gap:8px; background:linear-gradient(135deg,rgba(30,35,45,.85) 0%,rgba(25,30,40,.9) 100%); border:1px solid rgba(139,92,246,.25); padding:6px 10px; border-radius:10px; margin-bottom:10px; }
.imp-search input { background:transparent; border:none; outline:none; color:var(--polychat-text-primary); font-size:12px; font-family:'Space Grotesk',sans-serif; flex:1; }
.imp-search input::placeholder { color:rgba(156,163,175,.65); }
.imp-list { list-style:none; margin:0; padding:0; max-height:220px; overflow-y:auto; display:flex; flex-direction:column; gap:6px; }
.imp-item { display:flex; flex-direction:column; align-items:flex-start; text-align:left; background:linear-gradient(135deg,rgba(45,52,64,.35) 0%,rgba(40,47,59,.4) 100%); border:1px solid rgba(139,92,246,.22); padding:8px 10px; border-radius:10px; cursor:pointer; transition:all .25s cubic-bezier(.4,0,.2,1); position:relative; font-family:'Space Grotesk',sans-serif; }
.imp-item:hover, .imp-item:focus { background:linear-gradient(135deg,rgba(139,92,246,.18) 0%,rgba(124,58,237,.16) 100%); border-color:rgba(139,92,246,.5); outline:none; box-shadow:0 4px 12px -4px rgba(139,92,246,.35); }
.imp-name { font-size:12px; font-weight:600; color:var(--polychat-text-primary); line-height:1.1; }
.imp-desc { font-size:10px; font-family:'JetBrains Mono', monospace; color:var(--polychat-text-secondary); opacity:.85; margin-top:3px; letter-spacing:.3px; }
.imp-meta-row { display:flex; flex-wrap:wrap; gap:6px; align-items:center; margin-top:4px; }
.imp-provider { font-size:10px; font-family:'JetBrains Mono',monospace; background:rgba(139,92,246,.15); color:var(--polychat-accent-primary); padding:2px 6px; border-radius:6px; letter-spacing:.5px; text-transform:uppercase; }
.imp-price { font-size:10px; font-family:'JetBrains Mono',monospace; color:var(--polychat-text-secondary); background:rgba(255,255,255,.05); padding:2px 6px; border-radius:6px; letter-spacing:.3px; }
.imp-price-free { 
  background:linear-gradient(135deg, rgba(16,185,129,.28) 0%, rgba(16,185,129,.18) 100%);
  color: var(--polychat-success);
  border:1px solid rgba(16,185,129,.55);
  box-shadow:0 0 0 1px rgba(16,185,129,.25), inset 0 1px 0 rgba(255,255,255,.08);
}
.imp-price-paid { 
  /* Harmonized with Settings .price-block.paid (blue palette) */
  background:rgba(59,130,246,.15);
  color:#60a5fa;
  border:1px solid rgba(59,130,246,.35);
  box-shadow:0 0 0 1px rgba(59,130,246,.25), inset 0 1px 0 rgba(255,255,255,.08);
}
.imp-price-free:hover, .imp-price-free:focus { border-color:rgba(16,185,129,.75); }
.imp-price-paid:hover, .imp-price-paid:focus { border-color:rgba(59,130,246,.55); box-shadow:0 0 0 1px rgba(59,130,246,.4), inset 0 1px 0 rgba(255,255,255,.12); }
.imp-empty { font-size:12px; font-style:italic; text-align:center; padding:12px 0 4px; color:rgba(156,163,175,.7); }
.imp-list::-webkit-scrollbar { width:8px; }
.imp-list::-webkit-scrollbar-track { background:rgba(255,255,255,.05); border-radius:10px; }
.imp-list::-webkit-scrollbar-thumb { background:linear-gradient(var(--polychat-accent-primary),var(--polychat-accent-secondary)); border-radius:10px; border:1px solid rgba(0,0,0,.35); }

.chat-header-modern-subtitle {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  color: var(--polychat-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.chat-header-modern-status {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.chat-status-indicator-modern {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  transition: var(--transition-normal);
}

.chat-status-indicator-modern.active {
  background: var(--polychat-success);
  box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
}

.chat-status-indicator-modern.loading {
  background: var(--polychat-warning);
  animation: modernPulse 1.5s ease-in-out infinite;
}

.chat-status-text-modern {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  color: var(--polychat-text-secondary);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Contenu du chat */
.chat-content-modern {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  min-height: 0;
}

.chat-messages-modern {
  flex: 1;
  overflow-y: auto;
  padding: var(--spacing-md) var(--spacing-lg);
  scroll-behavior: smooth;
  min-height: 250px; /* Augmenté de 200px à 250px */
  max-height: 60vh; /* Augmenté de 50vh à 60vh */
}

/* Scrollbar pour les messages - Style visible et fonctionnel */
.chat-messages-modern::-webkit-scrollbar {
  width: 10px; /* Assez large pour être visible */
}

.chat-messages-modern::-webkit-scrollbar-track {
  background: var(--polychat-bg-secondary);
  border-radius: 14px;
}

.chat-messages-modern::-webkit-scrollbar-thumb {
  background: var(--polychat-accent-primary);
  border-radius: 14px;
  border: 1px solid var(--polychat-bg-tertiary);
}

.chat-messages-modern::-webkit-scrollbar-thumb:hover {
  background: var(--polychat-accent-secondary);
  box-shadow: var(--shadow-cyber);
}

/* Message d'accueil modernisé */
.chat-welcome-modern {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: var(--spacing-2xl);
  margin: var(--spacing-xl) 0;
  background: var(--gradient-glass);
  border: var(--border-thin);
  border-color: var(--polychat-accent-primary);
  border-radius: 22px;
  animation: modernFadeIn 0.6s ease;
}

.chat-welcome-modern-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 64px;
  height: 64px;
  background: var(--gradient-cyber);
  border-radius: 22px;
  margin-bottom: var(--spacing-lg);
  color: var(--polychat-text-inverse);
  animation: subtleHighlight 3s ease-in-out infinite;
}

.chat-welcome-modern-content {
  max-width: 300px;
}

.chat-welcome-modern-title {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 18px;
  font-weight: 700;
  color: var(--polychat-text-primary);
  margin: 0 0 var(--spacing-sm) 0;
}

.chat-welcome-modern-subtitle {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--polychat-text-secondary);
  margin: 0 0 var(--spacing-lg) 0;
  opacity: 0.8;
}

.chat-welcome-modern-features {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-sm);
  justify-content: center;
}

.chat-welcome-modern-feature {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  background: var(--polychat-bg-secondary);
  color: var(--polychat-text-secondary);
  padding: 4px var(--spacing-sm);
  border-radius: 30px;
  border: var(--border-thin);
  border-color: var(--polychat-accent-muted);
  transition: var(--transition-normal);
}

/* Streaming progress */
.chat-stream-progress {
  display:flex;
  align-items:center;
  gap:8px;
  padding:4px 12px 8px;
  font-family:'JetBrains Mono', monospace;
  font-size:10px;
  color:var(--polychat-text-secondary);
}
.chat-stream-bar { flex:1; height:6px; background:rgba(255,255,255,0.08); border-radius:4px; overflow:hidden; position:relative; }
.chat-stream-bar-fill { height:100%; background:linear-gradient(90deg, var(--polychat-accent-primary), var(--polychat-accent-secondary)); transition:width .25s ease; width:10%; }
/* Width buckets (steps of 5%) */
.chat-stream-bar-fill.w-15{width:15%;}
.chat-stream-bar-fill.w-20{width:20%;}
.chat-stream-bar-fill.w-25{width:25%;}
.chat-stream-bar-fill.w-30{width:30%;}
.chat-stream-bar-fill.w-35{width:35%;}
.chat-stream-bar-fill.w-40{width:40%;}
.chat-stream-bar-fill.w-45{width:45%;}
.chat-stream-bar-fill.w-50{width:50%;}
.chat-stream-bar-fill.w-55{width:55%;}
.chat-stream-bar-fill.w-60{width:60%;}
.chat-stream-bar-fill.w-65{width:65%;}
.chat-stream-bar-fill.w-70{width:70%;}
.chat-stream-bar-fill.w-75{width:75%;}
.chat-stream-bar-fill.w-80{width:80%;}
.chat-stream-bar-fill.w-85{width:85%;}
.chat-stream-bar-fill.w-90{width:90%;}
.chat-stream-metric { white-space:nowrap; }

.chat-welcome-modern-feature:hover {
  background: var(--polychat-accent-primary);
  color: var(--polychat-text-inverse);
  border-color: var(--polychat-accent-primary);
  transform: translateY(-1px);
}

/* Footer du chat */
.chat-footer-modern {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-sm) var(--spacing-lg);
  background: var(--polychat-bg-secondary);
  border-top: var(--border-thin);
  border-color: var(--polychat-accent-muted);
  flex-shrink: 0;
}

.chat-footer-modern-info {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  color: var(--polychat-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.chat-footer-modern-error {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  color: var(--polychat-error);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  animation: modernPulse 2s ease-in-out infinite;
}

/* État vide modernisé */
.chat-empty-state-modern {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  text-align: center;
  padding: var(--spacing-2xl);
  background: var(--gradient-glass);
  border: var(--border-thin);
  border-color: var(--polychat-accent-muted);
  border-radius: 22px;
  margin: var(--spacing-lg);
  animation: modernFadeIn 0.8s ease;
}

.chat-empty-state-modern-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 80px;
  height: 80px;
  background: var(--polychat-bg-secondary);
  border: var(--border-thick);
  border-color: var(--polychat-accent-muted);
  border-radius: 26px;
  margin-bottom: var(--spacing-xl);
  color: var(--polychat-accent-muted);
  opacity: 0.7;
}

.chat-empty-state-modern-title {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 20px;
  font-weight: 600;
  color: var(--polychat-text-primary);
  margin: 0 0 var(--spacing-md) 0;
}

.chat-empty-state-modern-description {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  color: var(--polychat-text-secondary);
  margin: 0;
  opacity: 0.8;
  max-width: 300px;
}

/* Responsive pour le multi-chat */
@media (max-width: 1024px) {
  .multi-chat-grid-modern.grid-3 {
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
  }
  
  .multi-chat-grid-modern.grid-3 .chat-session-modern:nth-child(3) {
    grid-column: 1 / -1;
  }
}

@media (max-width: 768px) {
  .multi-chat-grid-modern {
    grid-template-columns: 1fr !important;
    grid-template-rows: repeat(auto-fit, minmax(350px, 1fr));
    gap: var(--spacing-sm);
    padding: var(--spacing-sm);
  }
  
  .chat-session-modern {
    min-height: 300px;
    max-height: 60vh;
  }
  
  .chat-header-modern {
    padding: var(--spacing-sm) var(--spacing-md);
  }
  
  .chat-messages-modern {
    padding: var(--spacing-sm) var(--spacing-md);
    min-height: 200px;
  }
  
  .chat-welcome-modern {
    padding: var(--spacing-lg);
    margin: var(--spacing-md) 0;
  }
  
  .chat-welcome-modern-icon {
    width: 48px;
    height: 48px;
  }
  
  .chat-welcome-modern-title {
    font-size: 16px;
  }
}

@media (max-width: 480px) {
  .chat-header-modern-details {
    display: none;
  }
  
  .chat-footer-modern {
    padding: var(--spacing-xs) var(--spacing-sm);
  }
  
  .chat-empty-state-modern {
    margin: var(--spacing-sm);
    padding: var(--spacing-lg);
  }
  
  .chat-empty-state-modern-icon {
    width: 60px;
    height: 60px;
  }
  
  /* Optimisation du scroll sur mobile */
  .chat-session-modern {
    min-height: 350px; /* Augmenté de 300px à 350px */
  }
  
  .chat-messages-modern {
    padding: var(--spacing-sm);
    min-height: 200px; /* Ajouté une hauteur min pour mobile */
  }
  
  .chat-empty-state-modern-title {
    font-size: 18px;
  }
  
  .chat-empty-state-modern-description {
    font-size: 12px;
  }
}
